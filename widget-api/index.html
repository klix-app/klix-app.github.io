



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Klix Developer documentation">
      
      
      
        <meta name="author" content="Klix Development Team">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/logos/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Legacy Klix API (deprecated) - Klix Developers</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../stylesheets/klix.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-149580135-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
<!-- Klix Pay/Checkout widget -->
<script type="module" src="https://klix.blob.core.windows.net/stage/widget/build/klixwidget.esm.js"></script>
<script nomodule src="https://klix.blob.core.windows.net/stage/widget/build/klixwidget.js"></script>
<!-- Klix Pay Later widget -->
<script type="module" src="https://klix.blob.core.windows.net/stage/pay-later-widget/build/klix-pay-later-widget.esm.js"></script>
<script nomodule="" src="https://klix.blob.core.windows.net/stage/pay-later-widget/build/klix-pay-later-widget.js"></script>
<script type="text/javascript">window.$crisp=[];window.CRISP_WEBSITE_ID="a5ad4e02-afc6-4a09-907d-67bedb386f14";(function(){d=document;s=d.createElement("script");s.src="https://client.crisp.chat/l.js";s.async=1;d.getElementsByTagName("head")[0].appendChild(s);})();</script>

  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="klix-theme-primary" data-md-color-accent="klix-theme-accent">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#legacy-klix-api-deprecated" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">
  
        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href=".."
              title="Klix Developers"
              class="md-header-nav__button md-logo">
            
              <img src="../images/logos/klix_white.png" width="64" height="64" />
            
          </a>
        </div>
  
        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>
  
        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              <span class="md-header-nav__topic">
                Klix Developers
              </span>
              <span class="md-header-nav__topic">
                
                  Legacy Klix API (deprecated)
                
              </span>
            
          </div>
        </div>
  
        <!-- Button to open search dialogue -->
        <div class="md-flex__cell md-flex__cell--shrink">
          
            <label class="md-icon md-icon--search md-header-nav__button"
                for="__search"></label>
  
            <!-- Search interface -->
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        </div>
  
        <!-- Repository containing source -->
        
          <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__source">
              


  

<a href="https://github.com/klix-app/klix-developer-documentation-website" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    klix-app/klix-developer-documentation-website
  </div>
</a>
            </div>
          </div>
        
      </div>
    </nav>
  </header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Klix Developers" class="md-nav__button md-logo">
      
        <img src="../images/logos/klix_white.png" width="48" height="48">
      
    </a>
    Klix Developers
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/klix-app/klix-developer-documentation-website" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    klix-app/klix-developer-documentation-website
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../test-environment/" title="Test environment" class="md-nav__link">
      Test environment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../plugins-for-ecommerce-platforms/" title="Plugins for eCommerce platforms" class="md-nav__link">
      Plugins for eCommerce platforms
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../libraries/" title="Libraries" class="md-nav__link">
      Libraries
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../api/" title="Direct integration using API" class="md-nav__link">
      Direct integration using API
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Legacy Klix API (deprecated)
      </label>
    
    <a href="./" title="Legacy Klix API (deprecated)" class="md-nav__link md-nav__link--active">
      Legacy Klix API (deprecated)
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-start-guide" class="md-nav__link">
    Quick Start guide
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integration-steps" class="md-nav__link">
    Integration steps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-embed-klix-widget-into-your-web-shop" class="md-nav__link">
    1. Embed Klix widget into your web shop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-pass-order-information-to-klix-widget" class="md-nav__link">
    2. Pass order information to Klix widget
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-implement-an-end-point-that-will-be-invoked-upon-payment-completetion" class="md-nav__link">
    3. Implement an end-point that will be invoked upon payment completetion
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-integration-instructions" class="md-nav__link">
    Step by step integration instructions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-get-access-to-klix-merchant-console" class="md-nav__link">
    1. Get access to Klix Merchant Console
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-decide-which-integration-scenario-suits-you-best" class="md-nav__link">
    2. Decide which integration scenario suits you best
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-provide-integration-configuration-in-merchant-console" class="md-nav__link">
    3. Provide integration configuration in Merchant Console
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-add-widget-html-code-to-your-web-page" class="md-nav__link">
    4. Add widget HTML code to your web-page
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-implement-purchase-completed-callback-end-point" class="md-nav__link">
    5. Implement purchase completed callback end-point
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-implement-callbacks-to-navigate-back-to-payment-method-selection-page-or-display-additional-message-in-case-of-successfull-payment" class="md-nav__link">
    6. Implement callbacks to navigate back to payment method selection page or display additional message in case of successfull payment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-test-integration" class="md-nav__link">
    7. Test integration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-sign-agreement-and-request-access-to-production-environment" class="md-nav__link">
    8. Sign agreement and request access to production environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-pass-checklist-on-production-environment" class="md-nav__link">
    9. Pass checklist on production environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-configuration" class="md-nav__link">
    Integration configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-complete-the-merchant-profile-in-merchant-console" class="md-nav__link">
    1. Complete the merchant profile in Merchant Console
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-download-klix-public-key" class="md-nav__link">
    2. Download Klix public key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-generate-privatepublic-key-pair-for-signing-the-api-requests" class="md-nav__link">
    3. Generate private/public key pair for signing the API requests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-create-a-widget" class="md-nav__link">
    4. Create a widget
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-store-api-key" class="md-nav__link">
    5. Store API key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks" class="md-nav__link">
    Callbacks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#callback-urls" class="md-nav__link">
    Callback URLs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purchase-notification-request-example" class="md-nav__link">
    Purchase notification request example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shipping-cost-calculation-request-example" class="md-nav__link">
    Shipping cost calculation request example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#callback-payload-signature-validation" class="md-nav__link">
    Callback payload signature validation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-no-2-klix-checkout-widget-with-multiple-order-items-and-order-delivery" class="md-nav__link">
    Example No 2: Klix Checkout widget with multiple order items and order delivery
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#klix-widget" class="md-nav__link">
    Klix Widget
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#klix-widget-placement" class="md-nav__link">
    Klix Widget placement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#widget-configuration" class="md-nav__link">
    Widget Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specifying-widget-language" class="md-nav__link">
    Specifying widget language
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefilling-klix-widget-form-data" class="md-nav__link">
    Prefilling Klix widget form data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instant-fixed-price-widget-type" class="md-nav__link">
    INSTANT (Fixed Price) Widget Type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkout-dynamic-price-widget-type" class="md-nav__link">
    CHECKOUT (Dynamic Price) Widget Type
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#html-api-for-single-order-item" class="md-nav__link">
    HTML API for single order item
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#html-api-for-multiple-order-items" class="md-nav__link">
    HTML API for multiple order items
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    Implementation details
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#js-api-for-single-and-multiple-order-items" class="md-nav__link">
    JS API for single and multiple order items
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-item-attributes" class="md-nav__link">
    Order Item attributes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#javascript-callbacks" class="md-nav__link">
    Javascript callbacks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payment-completed-callback" class="md-nav__link">
    Payment completed callback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigate-back-to-payment-method-selection-shopping-cart-page" class="md-nav__link">
    Navigate back to payment method selection / shopping cart page
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limiting-accepted-cards" class="md-nav__link">
    Limiting accepted cards
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-libraries" class="md-nav__link">
    Client libraries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#available-libraries" class="md-nav__link">
    Available libraries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#php" class="md-nav__link">
    PHP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-testing" class="md-nav__link">
    Integration testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environments" class="md-nav__link">
    Environments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-environment-bank-cards" class="md-nav__link">
    Test environment bank cards
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merchant-api-v2" class="md-nav__link">
    Merchant API v2
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#swagger-documentation" class="md-nav__link">
    Swagger documentation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-method" class="md-nav__link">
    Authentication method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signing-requests-without-request-body" class="md-nav__link">
    Signing requests without request body
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signing-requests-with-request-body" class="md-nav__link">
    Signing requests with request body
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#libraries" class="md-nav__link">
    Libraries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../static-assets/" title="Static assets" class="md-nav__link">
      Static assets
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../representation-guidelines/" title="Representation guidelines" class="md-nav__link">
      Representation guidelines
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../marketing-guidelines/" title="Marketing guidelines" class="md-nav__link">
      Marketing guidelines
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-start-guide" class="md-nav__link">
    Quick Start guide
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integration-steps" class="md-nav__link">
    Integration steps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-embed-klix-widget-into-your-web-shop" class="md-nav__link">
    1. Embed Klix widget into your web shop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-pass-order-information-to-klix-widget" class="md-nav__link">
    2. Pass order information to Klix widget
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-implement-an-end-point-that-will-be-invoked-upon-payment-completetion" class="md-nav__link">
    3. Implement an end-point that will be invoked upon payment completetion
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-integration-instructions" class="md-nav__link">
    Step by step integration instructions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-get-access-to-klix-merchant-console" class="md-nav__link">
    1. Get access to Klix Merchant Console
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-decide-which-integration-scenario-suits-you-best" class="md-nav__link">
    2. Decide which integration scenario suits you best
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-provide-integration-configuration-in-merchant-console" class="md-nav__link">
    3. Provide integration configuration in Merchant Console
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-add-widget-html-code-to-your-web-page" class="md-nav__link">
    4. Add widget HTML code to your web-page
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-implement-purchase-completed-callback-end-point" class="md-nav__link">
    5. Implement purchase completed callback end-point
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-implement-callbacks-to-navigate-back-to-payment-method-selection-page-or-display-additional-message-in-case-of-successfull-payment" class="md-nav__link">
    6. Implement callbacks to navigate back to payment method selection page or display additional message in case of successfull payment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-test-integration" class="md-nav__link">
    7. Test integration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-sign-agreement-and-request-access-to-production-environment" class="md-nav__link">
    8. Sign agreement and request access to production environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-pass-checklist-on-production-environment" class="md-nav__link">
    9. Pass checklist on production environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-configuration" class="md-nav__link">
    Integration configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-complete-the-merchant-profile-in-merchant-console" class="md-nav__link">
    1. Complete the merchant profile in Merchant Console
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-download-klix-public-key" class="md-nav__link">
    2. Download Klix public key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-generate-privatepublic-key-pair-for-signing-the-api-requests" class="md-nav__link">
    3. Generate private/public key pair for signing the API requests
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-create-a-widget" class="md-nav__link">
    4. Create a widget
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-store-api-key" class="md-nav__link">
    5. Store API key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks" class="md-nav__link">
    Callbacks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#callback-urls" class="md-nav__link">
    Callback URLs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purchase-notification-request-example" class="md-nav__link">
    Purchase notification request example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shipping-cost-calculation-request-example" class="md-nav__link">
    Shipping cost calculation request example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#callback-payload-signature-validation" class="md-nav__link">
    Callback payload signature validation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-no-2-klix-checkout-widget-with-multiple-order-items-and-order-delivery" class="md-nav__link">
    Example No 2: Klix Checkout widget with multiple order items and order delivery
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#klix-widget" class="md-nav__link">
    Klix Widget
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#klix-widget-placement" class="md-nav__link">
    Klix Widget placement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#widget-configuration" class="md-nav__link">
    Widget Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specifying-widget-language" class="md-nav__link">
    Specifying widget language
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefilling-klix-widget-form-data" class="md-nav__link">
    Prefilling Klix widget form data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instant-fixed-price-widget-type" class="md-nav__link">
    INSTANT (Fixed Price) Widget Type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkout-dynamic-price-widget-type" class="md-nav__link">
    CHECKOUT (Dynamic Price) Widget Type
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#html-api-for-single-order-item" class="md-nav__link">
    HTML API for single order item
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#html-api-for-multiple-order-items" class="md-nav__link">
    HTML API for multiple order items
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    Implementation details
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#js-api-for-single-and-multiple-order-items" class="md-nav__link">
    JS API for single and multiple order items
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-item-attributes" class="md-nav__link">
    Order Item attributes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#javascript-callbacks" class="md-nav__link">
    Javascript callbacks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#payment-completed-callback" class="md-nav__link">
    Payment completed callback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigate-back-to-payment-method-selection-shopping-cart-page" class="md-nav__link">
    Navigate back to payment method selection / shopping cart page
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limiting-accepted-cards" class="md-nav__link">
    Limiting accepted cards
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-libraries" class="md-nav__link">
    Client libraries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#available-libraries" class="md-nav__link">
    Available libraries
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#php" class="md-nav__link">
    PHP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-testing" class="md-nav__link">
    Integration testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environments" class="md-nav__link">
    Environments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-environment-bank-cards" class="md-nav__link">
    Test environment bank cards
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merchant-api-v2" class="md-nav__link">
    Merchant API v2
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#swagger-documentation" class="md-nav__link">
    Swagger documentation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-method" class="md-nav__link">
    Authentication method
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signing-requests-without-request-body" class="md-nav__link">
    Signing requests without request body
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signing-requests-with-request-body" class="md-nav__link">
    Signing requests with request body
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#libraries" class="md-nav__link">
    Libraries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="legacy-klix-api-deprecated">Legacy Klix API (deprecated)<a class="headerlink" href="#legacy-klix-api-deprecated" title="Permanent link">&para;</a></h1>
<h2 id="quick-start-guide">Quick Start guide<a class="headerlink" href="#quick-start-guide" title="Permanent link">&para;</a></h2>
<p>This 5 minute guide covers overview of Klix integration technical aspects.</p>
<h3 id="integration-steps">Integration steps<a class="headerlink" href="#integration-steps" title="Permanent link">&para;</a></h3>
<p>A central part of Klix checkout/payment solution is Klix web widget - HTML web component i.e. form for entering customer's credit card data. Klix widget accepts merchant order parameters (order identifier, amount, payment description, etc.) via HTML element attributes. The following steps describe actions that you need to perform in order to add Klix widget to your webshop and accept a callback on a server-side once payment has been successfully processed by Klix.</p>
<h4 id="1-embed-klix-widget-into-your-web-shop">1. Embed Klix widget into your web shop<a class="headerlink" href="#1-embed-klix-widget-into-your-web-shop" title="Permanent link">&para;</a></h4>
<p>In order to embed Klix widget into your web shop following HTML fragment referencing Klix widget JavaScript should be added to your web shop checkout page.</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span>  
        <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://klix.blob.core.windows.net/stage/widget/build/klixwidget.esm.js&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">nomodule</span>  
        <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://klix.blob.core.windows.net/stage/widget/build/klixwidget.js&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</code></pre></div>
<p>Note that Klix widget JavaScript code should be loaded from different destinations on production and test environments. See Testing integration <a href="#environments">Environments</a> section for details.</p>
<h4 id="2-pass-order-information-to-klix-widget">2. Pass order information to Klix widget<a class="headerlink" href="#2-pass-order-information-to-klix-widget" title="Permanent link">&para;</a></h4>
<p>Next step is to place Klix widget HTML code in an appropriate place on a checkout page where this widget will be rendered and pass order/payment related information.</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;21ca7904-ff16-48b5-918d-c2d80af81f05&quot;</span>  
    <span class="na">amount</span><span class="o">=</span><span class="s">&quot;5.45&quot;</span>  
    <span class="na">currency</span><span class="o">=</span><span class="s">&quot;EUR&quot;</span>  
    <span class="na">label</span><span class="o">=</span><span class="s">&quot;Order No 12345678&quot;</span>  
    <span class="na">language</span><span class="o">=</span><span class="s">&quot;lv&quot;</span>
    <span class="na">back-to-merchant-url</span><span class="o">=</span><span class="s">&quot;https://developers.klix.app/&quot;</span>
    <span class="na">signature</span><span class="o">=</span><span class="s">&quot;E2Ag7p/v9cUQ1U5ntkYIZuDwXPErBxZWA19mGFaW/hRDXlnWvY8UH5jF991/fTgWE5Ls/3DHi5cbbZbM7zkGBT/MB13oVt6QJEtJLIFHi8t5Oqd61S6nSYcKgB/Ju4FvqbQcSaQavc1VS9zd8sgq4BuUzhyF4rb/ErI5wq6VqvDfJLNneL3kfxAcoxtU1lVvYoqZWFz52MN57aFwa7A9wJJRGmpETXFl6jYeFLLYTUjb67eiuMs60vxGh8CFpNCXlJpHzVV3cMTb+h7xit+HCwUDvM8mXwlPWXzg5F4orsoHPHWbMx2HXh8BuwZ5uXnwJar0zFioYlKqLZ+qxje0Bg==&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
</code></pre></div>
<p>Note that attribute <code>signature</code> should contain valid order signature. See section <a href="#signing-order">Signing order</a> for detailed instructions on how to generate a valid signature. Attribute <code>back-to-merchant-url</code> allows to specify a URL where customer will be redirected in case of cancelled purchase.
Here's Klix widget that corresponds to previously mentioned HTML code.</p>
<!-- markdownlint-disable MD033 -->
<details>
    <summary>Click to load Klix widget</summary>

<div>
    <klix-checkout widget-id="21ca7904-ff16-48b5-918d-c2d80af81f05" amount="5.45" currency="EUR" label="Order No 12345678" language="lv" signature="B+nre6Oe6lnjh0hcW5dhOtRmXxN3pm6Sup3kjcNeQiSmTN6zQCp6kHErX/s+JIvkLIqQxD2D/EU2MUraQC03RyKHyX/Wr8qVVbPeBaskPkYR7l397BBYOghvVN1LS8RWdpQ4Q67kMYdPutqnJAUGJtHA51i14xmnaIRxctpK4UJE3qtfu1QjWPez/yP1lT/igpCTL66lqXKcbHac75v++5WUwwT5fCEUklPxudzC3qbujNhXZBPwAZxa2GaYQDzCOP7p/bcJgH/DwsaVMiDtekG5ANgXB51WOPB9X3pP1rdr6kbVccXhN0D4UrxMt3ZA4bPw+LaAWzVRNaVOJoNpZg=="></klix-checkout>
</div>
</details>
<!-- markdownlint-disable MD033 -->

<h4 id="3-implement-an-end-point-that-will-be-invoked-upon-payment-completetion">3. Implement an end-point that will be invoked upon payment completetion<a class="headerlink" href="#3-implement-an-end-point-that-will-be-invoked-upon-payment-completetion" title="Permanent link">&para;</a></h4>
<p>After payment is completed (both successfully or failed) Klix server will send a callback HTTP request to your API end-point defined in Merchant Console. See <a href="#purchase-notification-request-example">Purchase notification HTTP request example</a>.
Note that first thing upon receiving purchase completed HTTP request you should verify request signature in order to ensure that request was sent by Klix server. See <a href="#callback-payload-signature-validation">Callback payload signature validation</a> for details.</p>
<h2 id="step-by-step-integration-instructions">Step by step integration instructions<a class="headerlink" href="#step-by-step-integration-instructions" title="Permanent link">&para;</a></h2>
<h3 id="1-get-access-to-klix-merchant-console">1. Get access to Klix Merchant Console<a class="headerlink" href="#1-get-access-to-klix-merchant-console" title="Permanent link">&para;</a></h3>
<p>Klix Merchant Console is a merchant self-service web-page for merchant profile and order data management.
In order to receive access to Merchant Console contact <a href="mailto:support@klix.app?subject=Merchant%20onboarding%20request&amp;body=Hello.%0D%0AWe would like to request access to Klix checkout solution.%0D%0AKlix Merchant Console and API will be accessed from the following IP addresses on the test environment: PLEASE_REPLACE_THIS_WITH_IP_ADDESS%0D%0AE-mail address to access Merchant Console: PLEASE_REPLACE_THIS_WITH_EMAIL_ADDRESS">support@klix.app</a> and request merchant onboarding in Klix.
Make sure to specify IP address from which Klix solution will be accessed and e-mail address for logging into Merchant Console. Merchant Console invitation e-mail will be sent after the request has been reviewed.</p>
<h3 id="2-decide-which-integration-scenario-suits-you-best">2. Decide which integration scenario suits you best<a class="headerlink" href="#2-decide-which-integration-scenario-suits-you-best" title="Permanent link">&para;</a></h3>
<p>There are three types of integration scenarios currently supported by Klix. Choose one depending on a type of your existing webshop:</p>
<ol>
<li>
<p>Simple static merchant website integration. For each product separate Klix Instant Widget should be created and widget's HTML code should be placed on merchant's product page. In such case only specific product(s) can be purchased using specific widget and for each product(s) a separate widget should be created. Orders and payments are fully managed in Klix Merchant Console. Therefore this integration type is suitable for rather small product catalog (up to 10 - 15 products).
<img alt="Simple integration using instant widget" src="../images/instant_widget.png" title="Instant widget" /></p>
</li>
<li>
<p>Klix Pay. Klix widget is integrated into custom built or standard e-commerce platform webshop and is used just as a payment option. In such case webshop's existing checkout page is responsible for collecting customer's information including delivery addressw. It means that Klix  Single Klix Checkout Widget can be created to handle multi-product shopping carts and unlimited product catalogs. This requires <a href="#callbacks">callbacks</a> implementation in merchant's web store.</p>
<p><!-- markdownlint-disable MD033 -->
<details>
<summary>Klix Pay example</summary></p>
<p><klix-checkout widget-id="21ca7904-ff16-48b5-918d-c2d80af81f05" amount="5.45" currency="EUR" label="Order No 12345678" language="lv" signature="B+nre6Oe6lnjh0hcW5dhOtRmXxN3pm6Sup3kjcNeQiSmTN6zQCp6kHErX/s+JIvkLIqQxD2D/EU2MUraQC03RyKHyX/Wr8qVVbPeBaskPkYR7l397BBYOghvVN1LS8RWdpQ4Q67kMYdPutqnJAUGJtHA51i14xmnaIRxctpK4UJE3qtfu1QjWPez/yP1lT/igpCTL66lqXKcbHac75v++5WUwwT5fCEUklPxudzC3qbujNhXZBPwAZxa2GaYQDzCOP7p/bcJgH/DwsaVMiDtekG5ANgXB51WOPB9X3pP1rdr6kbVccXhN0D4UrxMt3ZA4bPw+LaAWzVRNaVOJoNpZg=="></klix-checkout></p>
<p></details>
<!-- markdownlint-disable MD033 --></p>
</li>
<li>
<p>Klix Checkout. Just as in Klix Pay scenario Klix widget is integrated into custom built or standard e-commerce platform webshop but in this case Klix is used as a full checkout solution. It means that order information is still maintained in merchant's webshop and during checkout process order information is passed to Klix wiget which is responsible for collecting customer's information including delivery address. Same as in Klix Pay scenario both after successful and failed payment merchant's <a href="#callbacks">callback</a> is invoked by passing both order, customer and delivery information.</p>
<p><!-- markdownlint-disable MD033 -->
<details>
<summary>Klix Checkout example</summary></p>
<p><klix-checkout widget-id="8c597447-5234-4de1-ab85-b54e252098ce" language="lv" order="{&quot;items&quot;: [{&quot;orderItemId&quot;: &quot;12345&quot;, &quot;amount&quot;: 88, &quot;taxRate&quot;: 0.21, &quot;currency&quot;: &quot;EUR&quot;, &quot;label&quot;: &quot;Vacuum cleaner TP-3&quot;}, {&quot;amount&quot;: 9.39, &quot;currency&quot;: &quot;EUR&quot;, &quot;label&quot;: &quot;TP-3 HEPA filter&quot;,&quot;count&quot;: 2, &quot;unit&quot;: &quot;PIECE&quot;}], &quot;shippingOptions&quot;: [{&quot;id&quot;:&quot;omniva&quot;,&quot;amount&quot;:2,&quot;currency&quot;:&quot;EUR&quot;,&quot;taxRate&quot;: 0.21},  {&quot;id&quot;:&quot;courier&quot;,&quot;amount&quot;:0}]}" signature="vy1KbYGxD2oZtSGvkoVLt8ZdHCkecbFpK9L7lsyK01D6FNvzTg3L3XF894sX68mmmPBm3BjMdw8QPsbz4d68aJu6WKj9hk5qu2sPmXKyt7ZgIVdHZJwI729g+Z5MFHDfmqbG1JBlQSYpMRrA1NX8zi1d4/+Sono1huvuc0H422BrxUt//CJSfug91mp/ZSkb7q5KiPZaZBpPHyNtNSuwvHUc5WO5KX2En0j4+8q/O3ekZEEDa5dsdhG4G2nZdb3ti8Wa4DQ+NTYmQ170QVoWtQwlleJ7MbP03K2kxikUqhEShLGfKkoFuhtkih0654ZnsG7AYs7ga8WvXEZ7SB2DHQ=="></klix-checkout></p>
</li>
</ol>
</details>
<!-- markdownlint-disable MD033 -->

<h3 id="3-provide-integration-configuration-in-merchant-console">3. Provide integration configuration in Merchant Console<a class="headerlink" href="#3-provide-integration-configuration-in-merchant-console" title="Permanent link">&para;</a></h3>
<p>Follow registration link in Merchant Console invitation e-mail and specify new password. After registration follow <a href="#integration-configuration">these steps</a> to configure integration.</p>
<h3 id="4-add-widget-html-code-to-your-web-page">4. Add widget HTML code to your web-page<a class="headerlink" href="#4-add-widget-html-code-to-your-web-page" title="Permanent link">&para;</a></h3>
<p>Add Klix widget HTML code to your product or checkout page depending on a type of used widget (instant, checkout, payment) and your webshop specifics. More information about widget configuration can be found in <a href="#klix-widget">Widget</a> section.</p>
<h3 id="5-implement-purchase-completed-callback-end-point">5. Implement purchase completed callback end-point<a class="headerlink" href="#5-implement-purchase-completed-callback-end-point" title="Permanent link">&para;</a></h3>
<p><a href="#callbacks">Callback</a> end-point should be implemented so that Klix can send payment status to merchant.</p>
<h3 id="6-implement-callbacks-to-navigate-back-to-payment-method-selection-page-or-display-additional-message-in-case-of-successfull-payment">6. Implement callbacks to navigate back to payment method selection page or display additional message in case of successfull payment<a class="headerlink" href="#6-implement-callbacks-to-navigate-back-to-payment-method-selection-page-or-display-additional-message-in-case-of-successfull-payment" title="Permanent link">&para;</a></h3>
<p>JavaScript <a href="#navigate-back-to-payment-method-selection-shopping-cart-page">callaback</a> should be implemented in order to allow customer to navigate back to payment method selection page or checkout page in case of failed or cancelled Klix payment.
Additional <a href="#payment-completed-callback">callback</a> can be implemented in order to adjust payment status page depending on a payment result.</p>
<h3 id="7-test-integration">7. Test integration<a class="headerlink" href="#7-test-integration" title="Permanent link">&para;</a></h3>
<p>Klix provides fully functional test environment that can be used to perform end to end <a href="#integration-testing">integration implementation testing</a>.</p>
<h3 id="8-sign-agreement-and-request-access-to-production-environment">8. Sign agreement and request access to production environment<a class="headerlink" href="#8-sign-agreement-and-request-access-to-production-environment" title="Permanent link">&para;</a></h3>
<p>After integration has been successfully tested on test environment you can proceed with creadentials request for production.</p>
<h3 id="9-pass-checklist-on-production-environment">9. Pass checklist on production environment<a class="headerlink" href="#9-pass-checklist-on-production-environment" title="Permanent link">&para;</a></h3>
<p>After integration configuration is completed on production environment you need to make test payments and pass few other tests from production readiness checklist.</p>
<h2 id="integration-configuration">Integration configuration<a class="headerlink" href="#integration-configuration" title="Permanent link">&para;</a></h2>
<p>Integration configuration is done in Klix Merchant Console. After logging in Merchant Console follow these steps to configure Klix integration.</p>
<h3 id="1-complete-the-merchant-profile-in-merchant-console">1. Complete the merchant profile in Merchant Console<a class="headerlink" href="#1-complete-the-merchant-profile-in-merchant-console" title="Permanent link">&para;</a></h3>
<p>Fill in merchant data in "Business Profile view". Specify URL to merchant's terms &amp; conditions. Specify <a href="#callbacks">callback URLs</a> in case advanced integration (API &amp; callbacks based) is used.</p>
<p><img alt="Fill in merchant data in Business Profile view" src="../images/merchant_console_business_profile.png" title="Merchant business profile" /></p>
<h3 id="2-download-klix-public-key">2. Download Klix public key<a class="headerlink" href="#2-download-klix-public-key" title="Permanent link">&para;</a></h3>
<p>Head to Certificates page and copy public key contents from "Service Provider Certificate info" section.</p>
<p><img alt="Copy Klix public key" src="../images/merchant_console_certificates.png" title="Klix public key" /></p>
<p>Store public key contents in file and use this key to <a href="#callback-payload-signature-validation">validate</a> the Klix callback payload signature.</p>
<div class="admonition warning">
<p class="admonition-title">Callback payload signature validation</p>
<p>Merchant is obligated to perform Klix callback payload signature validation using Klix public key in order to ensure request payload integrity and authenticity.</p>
</div>
<h3 id="3-generate-privatepublic-key-pair-for-signing-the-api-requests">3. Generate private/public key pair for signing the API requests<a class="headerlink" href="#3-generate-privatepublic-key-pair-for-signing-the-api-requests" title="Permanent link">&para;</a></h3>
<p>Generate private/public key pair and download private key file. Merchant order details passed as Klix widget attributes and all data modification requests sent to Klix API e.g. payment refund should be signed using this private key. Klix will use merchant certificate public key to check each data modification request payload integrity and authenticity. In order to understand which merchant's certificate should be used to validate a HTTP request payload HTTP header <code>X-Klix-Key-ID</code> value should be specified. Header value can be obtained from Certificates page corresponding certificate's field "Name".</p>
<div class="admonition warning">
<p class="admonition-title">Security notice</p>
<p>Merchant is reponsible for storing certificate's private key securely. Merchant can generate a new certificate in Merchant Console and use this certificate to sign request payload and widget attrributes. Note that in such case HTTP header <code>X-Klix-Key-ID</code> value and Klix widget attribute <code>certificate-name</code> should match new certificate's name.</p>
</div>
<p><img alt="Create new merchant certificate" src="../images/merchant_console_certificate_created.png" title="New merchant certificate creation" /></p>
<h3 id="4-create-a-widget">4. Create a widget<a class="headerlink" href="#4-create-a-widget" title="Permanent link">&para;</a></h3>
<p>Head to Widgets section to create a new widget. Klix widget is Klix form configuration representation that is identifiable by it's id. There are tree types of widgets:</p>
<ul>
<li>Static widget</li>
<li>Klix Pay widget</li>
<li>Klix Checkout widget</li>
</ul>
<p>See <a href="#klix-widget">Widget</a> section for more detailed description of widget types and configuration.</p>
<h3 id="5-store-api-key">5. Store API key<a class="headerlink" href="#5-store-api-key" title="Permanent link">&para;</a></h3>
<p>Note that Klix standard checkout flow doesn't require a merchant to invoke Klix API. More advanced use cases like refunding an order can be handled both in Merchant Console or via Klix API. For each HTTP request sent to Klix API HTTP header called <code>X-KLIX-Api-Key</code> should be specified. Header value can be obtained from Certificates page "Merchant Api key info" section's field "Api key".</p>
<p><img alt="Add Klix API key to HTTP request headers" src="../images/merchant_console_api_key.png" title="Klix API key" /></p>
<h2 id="callbacks">Callbacks<a class="headerlink" href="#callbacks" title="Permanent link">&para;</a></h2>
<h3 id="callback-urls">Callback URLs<a class="headerlink" href="#callback-urls" title="Permanent link">&para;</a></h3>
<p>During order lifecycle Klix invokes API end-points implemented by merchant store. All URLs should be implemented and accessible via HTTPS in order to be callable by Klix.</p>
<div class="admonition warning">
<p class="admonition-title">Exposing you API via HTTPS on development environment</p>
<p>If you have trouble to expose your API via HTTPS on a development environment you can use <a href="https://ngrok.com">ngrok</a>.</p>
</div>
<table>
<thead>
<tr>
<th>URL Type</th>
<th>Example</th>
<th>Optional</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Purchase notification URL</td>
<td>https://merchant.com/purchases</td>
<td>false</td>
<td>HTTP PUT request is sent from Klix backend to confirm that a payment has either been collected successfully on behalf of the merchant or either payment has failed/was cancelled. Note that error code and message might not be present even in case of failed payment. See <a href="#purchase-notification-request-example">Purchase notification request example</a>.</td>
</tr>
<tr>
<td>Terms &amp; Conditions URL</td>
<td>https://merchant.com/terms.html</td>
<td>false</td>
<td>HTTP GET request is sent from user device (browser or mobile) to retrieve merchant legally binding agreement text.</td>
</tr>
<tr>
<td>Merchant Callback URL *</td>
<td>https://merchant.com/callbacks</td>
<td>true</td>
<td>Connection test end-point. HTTP OPTIONS request is sent from Klix backend to check if HTTP connection to merchant server can be established. This end-point should return HTTP status 200 and header Access-Control-Allow-Methods should contain POST method.</td>
</tr>
<tr>
<td>Order verification URL</td>
<td>https://merchant.com/orders</td>
<td>true</td>
<td>Deprecated in favour of <a href="#signing-order">order signing</a>. Used only in case of Klix widgets with valiation type <code>CALLBACK</code>. HTTP POST request is sent from Klix backend to this end-point whenever a customer submits an order in the checkout form. Merchant store should validate order data (check if selected product/service price is valid and is available in stock etc.) and either approve or reject an order. Note that Klix does not send full order information in notification request body. Only order identifier is sent as a JWS payload. You should check JWS signature, Base64 decode request payload to extract order identifier and use Klix API to retrieve order data by order identifier. Example JWS sent as a notification body: <code>eyJraWQiOiJNUGF5IiwiYWxnIjoiUlMyNTYifQ.eyJvcmRlcklkIjoiMWE2YTUzNjgtZTc5OS00OTY3LWI3NDItNjdhZGMxNmFlYzhhIn0.OZQU_2nPKUWl93U8YJJ9GjzZlLmmKS7ffuVu1WSZ5Y4JSU65LJxYs3kj0a460abXsBLkkVGX1Hi89fxNJ8CMsQ</code>. Base64 decoding middle part of this JWS token will lead to following JSON document <code>{"orderId":"1a6a5368-e799-4967-b742-67adc16aec8a","externalOrderId":"1233456789"}</code>, where <code>orderId</code> is Klix order identifier and <code>externalOrderId</code> is order identifier in merchant's system.</td>
</tr>
<tr>
<td>Shipping cost calculation URL</td>
<td>https://merchant.com/shipping-cost</td>
<td>true</td>
<td>HTTP POST request is sent from Klix backend in order to calculate shipping costs for certain order. Note that this end-point should be implemented only in case merchant supports dynamic pricing delivery i.e. delivery price can be determined only after Klix client has entered delivery address. Otherwise different delivery option cost can be passed as Klix <a href="#klix-widget">Widget</a> parameter. See <a href="#shipping-cost-calculation-request-example">Shipping cost calculation request example</a>.</td>
</tr>
</tbody>
</table>
<h4 id="purchase-notification-request-example">Purchase notification request example<a class="headerlink" href="#purchase-notification-request-example" title="Permanent link">&para;</a></h4>
<p>HTTP status code 200 should be returned by this API end-point otherwise Klix server will retry to send notification multiple times. In order to ensure that a purchase notification was sent by Klix and request was not altered it's important to <a href="#callback-payload-signature-validation">check a request signature</a>. In case of a successfull payment <code>"status"</code> field value is <code>"PAID"</code> and order in merchant web shop can be marked as paid.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
curl -x PUT https://your.site/payment-notifications <span class="se">\</span>
    -H <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="se">\</span>
    -H <span class="s1">&#39;X-Klix-Signature: MKqXr7siOkC6TYENeHUcy5ofFDiWpqMt+ow5iWJqnIYWU71W50fZFHfy3BVrehEGCvf+TufZK6DPymdM1e2G0w==&#39;</span> <span class="se">\</span>
    -d <span class="s1">&#39;{</span>
<span class="s1">        &quot;id&quot;:&quot;d72096a0-58f2-46f0-9a4c-6d2271784530&quot;,</span>
<span class="s1">        &quot;status&quot;:&quot;PAID&quot;,</span>
<span class="s1">        &quot;customer&quot;:{</span>
<span class="s1">            &quot;first_name&quot;:&quot;John&quot;,</span>
<span class="s1">            &quot;last_name&quot;:&quot;Doe&quot;,</span>
<span class="s1">            &quot;email&quot;:&quot;john.doe@klix.app&quot;,</span>
<span class="s1">            &quot;phone_number&quot;:&quot;37120000000&quot;</span>
<span class="s1">        },</span>
<span class="s1">        &quot;payment&quot;:{</span>
<span class="s1">            &quot;accountStatementReference&quot;:&quot;731589767&quot;,</span>
<span class="s1">            &quot;method&quot;: &quot;CARD&quot;,</span>
<span class="s1">            &quot;status&quot;: &quot;FAILED&quot;,</span>
<span class="s1">            &quot;error&quot;: {</span>
<span class="s1">                &quot;code&quot;: &quot;129&quot;,</span>
<span class="s1">                &quot;message&quot;: &quot;Decline, suspected counterfeit card&quot;</span>
<span class="s1">            }</span>
<span class="s1">        },</span>
<span class="s1">        &quot;tax_amount&quot;:18.53,</span>
<span class="s1">        &quot;total_amount&quot;:108.78,</span>
<span class="s1">        &quot;items&quot;:[</span>
<span class="s1">            {</span>
<span class="s1">                &quot;amount&quot;:72.73,</span>
<span class="s1">                &quot;label&quot;:&quot;Vacuum cleaner TP-3&quot;,</span>
<span class="s1">                &quot;tax_amount&quot;:15.27,</span>
<span class="s1">                &quot;total_amount&quot;:88.00,</span>
<span class="s1">                &quot;tax_rate&quot;:0.21,</span>
<span class="s1">                &quot;order_item_id&quot;:&quot;12345&quot;,</span>
<span class="s1">                &quot;quantity&quot;:1.000,</span>
<span class="s1">                &quot;unit&quot;:&quot;PIECE&quot;,</span>
<span class="s1">                &quot;type&quot;:&quot;UNKNOWN&quot;</span>
<span class="s1">            },</span>
<span class="s1">            {</span>
<span class="s1">                &quot;amount&quot;:6.13,</span>
<span class="s1">                &quot;label&quot;:&quot;TP-3 HEPA filter&quot;,</span>
<span class="s1">                &quot;tax_amount&quot;:3.26,</span>
<span class="s1">                &quot;total_amount&quot;:18.78,</span>
<span class="s1">                &quot;tax_rate&quot;:0.21,</span>
<span class="s1">                &quot;quantity&quot;:2.000,</span>
<span class="s1">                &quot;unit&quot;:&quot;PIECE&quot;,</span>
<span class="s1">                &quot;type&quot;:&quot;UNKNOWN&quot;</span>
<span class="s1">            },</span>
<span class="s1">            {</span>
<span class="s1">                &quot;amount&quot;:2.00,</span>
<span class="s1">                &quot;label&quot;:&quot;Piegāde&quot;,</span>
<span class="s1">                &quot;tax_amount&quot;:0.00,</span>
<span class="s1">                &quot;total_amount&quot;:2.00,</span>
<span class="s1">                &quot;tax_rate&quot;:0.00,</span>
<span class="s1">                &quot;quantity&quot;:1.000,</span>
<span class="s1">                &quot;unit&quot;:&quot;PIECE&quot;,</span>
<span class="s1">                &quot;type&quot;:&quot;SHIPPING&quot;</span>
<span class="s1">            }</span>
<span class="s1">        ],</span>
<span class="s1">        &quot;currency&quot;:&quot;EUR&quot;,</span>
<span class="s1">        &quot;merchant_urls&quot;:{</span>
<span class="s1">            &quot;confirmation&quot;:&quot;https://webhook.site/#!/6ddabff9-49af-4d4d-b221-7b607ffed276&quot;</span>
<span class="s1">        },</span>
<span class="s1">        &quot;shipping&quot;:{</span>
<span class="s1">            &quot;type&quot;:&quot;PICKUP_POINT&quot;,</span>
<span class="s1">            &quot;address&quot;:{</span>
<span class="s1">                &quot;country&quot;:&quot;Latvia&quot;,</span>
<span class="s1">                &quot;city&quot;:&quot;Rīga&quot;,</span>
<span class="s1">                &quot;street&quot;:&quot;Āzenes iela 5&quot;,</span>
<span class="s1">                &quot;latitude&quot;:24.08128,</span>
<span class="s1">                &quot;longitude&quot;:56.949924,</span>
<span class="s1">                &quot;postal_code&quot;:&quot;9934&quot;</span>
<span class="s1">            },</span>
<span class="s1">            &quot;method&quot;:{</span>
<span class="s1">                &quot;id&quot;:&quot;omniva&quot;,</span>
<span class="s1">                &quot;name&quot;:&quot;Omniva&quot;</span>
<span class="s1">            },</span>
<span class="s1">            &quot;contact_phone&quot;:&quot;37120000000&quot;,</span>
<span class="s1">            &quot;pickup_point&quot;:{</span>
<span class="s1">                &quot;name&quot;:&quot;Rīgas T/C Olimpia pakomāts&quot;,</span>
<span class="s1">                &quot;comments&quot;:&quot;Blakus iebrauktuvei pazemes autostāvvietā&quot;,</span>
<span class="s1">                &quot;external_id&quot;:&quot;9934&quot;,</span>
<span class="s1">                &quot;service_hours&quot;:&quot;P-Pk.piegāde 10:00, izņemšana 17:00 Sestdienās piegāde 14:00,izņemšana 14:00&quot;</span>
<span class="s1">            }</span>
<span class="s1">        },</span>
<span class="s1">        &quot;effective_amount&quot;:108.78</span>
<span class="s1">    }&#39;</span>
</code></pre></div>
<h4 id="shipping-cost-calculation-request-example">Shipping cost calculation request example<a class="headerlink" href="#shipping-cost-calculation-request-example" title="Permanent link">&para;</a></h4>
<p>Note that <code>pickup_point</code> is present only if customer has selected a delivery to pickup point, <code>address</code> is present both in case of delivery to address specified by customer and delivery to pickup point.</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
curl -x POST https://your.site/shipping-cost-calculations <span class="se">\</span>
    -H <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="se">\</span>
    -H <span class="s1">&#39;X-Klix-Signature: TODO&#39;</span> <span class="se">\</span>
    -d <span class="s1">&#39;{</span>
<span class="s1">        &quot;order_id&quot;: &quot;05957e7f-803f-46f0-9100-1c3e10199b43&quot;,</span>
<span class="s1">        &quot;order_items&quot;: [</span>
<span class="s1">            {</span>
<span class="s1">                &quot;reference&quot;: &quot;QZT-213&quot;,</span>
<span class="s1">                &quot;quantity&quot;: 2.000</span>
<span class="s1">            },</span>
<span class="s1">            {</span>
<span class="s1">                &quot;reference&quot;: &quot;TP-LNK-3840&quot;,</span>
<span class="s1">                &quot;quantity&quot;: 1.000</span>
<span class="s1">            }</span>
<span class="s1">        ],</span>
<span class="s1">        &quot;shipping_method_id&quot;: &quot;omniva&quot;,</span>
<span class="s1">        &quot;address&quot;: {</span>
<span class="s1">            &quot;city&quot;: &quot;Rīga&quot;,</span>
<span class="s1">            &quot;address&quot;: &quot;K.Valdemāra 62, Rīga&quot;,</span>
<span class="s1">            &quot;postal_code&quot;: &quot;LV-1013&quot;</span>
<span class="s1">        },</span>
<span class="s1">        &quot;pickup_point&quot;: {</span>
<span class="s1">            &quot;external_id&quot;: &quot;9111&quot;,</span>
<span class="s1">            &quot;name&quot;: &quot;Rīgas Briāna ielas Rimi pakomāts&quot;,</span>
<span class="s1">            &quot;comments&quot;: &quot;Pa labi no galvenās ieejas&quot;,</span>
<span class="s1">            &quot;service_hours&quot;: &quot;P-Pk. piegāde 10:00, iznemšana 17:00 Sestdienas piegāde 14:00, iznemšana 14:00&quot;</span>
<span class="s1">        }</span>
<span class="s1">    }&#39;</span>
</code></pre></div>
<h3 id="callback-payload-signature-validation">Callback payload signature validation<a class="headerlink" href="#callback-payload-signature-validation" title="Permanent link">&para;</a></h3>
<p>First thing upon receiving purchase completed HTTP request you should verify request signature in order to ensure that request was sent by Klix server. Signature is sent as HTTP header <code>X-Klix-Signature</code> value and should be verified using <code>SHA256WithRSA</code> algorithm and Klix public key that can be downloaded from Merchant Console. Example signature validation code:</p>
<p>```PHP tab=</p>
<?php
function is_signature_valid($payload, $signature_header_value) : int {
    $klix_public_key = <<<EOD
-----BEGIN CERTIFICATE-----
MIIB5TCCAY+gAwIBAgIENkY2rzANBgkqhkiG9w0BAQsFADBoMQswCQYDVQQGEwJM
VjEQMA4GA1UECBMHVW5rbm93bjEQMA4GA1UEBxMHVW5rbm93bjERMA8GA1UEChMI
Q2l0YWRlbGUxEDAOBgNVBAsTB1Vua25vd24xEDAOBgNVBAMTB1Vua25vd24wHhcN
MTgwNjEyMTMzNjM4WhcNMjgwNjA5MTMzNjM4WjBoMQswCQYDVQQGEwJMVjEQMA4G
A1UECBMHVW5rbm93bjEQMA4GA1UEBxMHVW5rbm93bjERMA8GA1UEChMIQ2l0YWRl
bGUxEDAOBgNVBAsTB1Vua25vd24xEDAOBgNVBAMTB1Vua25vd24wXDANBgkqhkiG
9w0BAQEFAANLADBIAkEAqAUyLiFAd4hxAh3LrbBrbqk+lmGPVFgS3996vTCQ/L/h
L9WnA+EPnxMV5LFyd49xsf5bbspaLrXnVmwkuvUC9wIDAQABoyEwHzAdBgNVHQ4E
FgQUzbA4JwE+SOUOJEd25iwpd9cajJMwDQYJKoZIhvcNAQELBQADQQBDtypgN8O3
AZ+H4CjH5Ihq+V5i/a3pL6nj8Dg502wejDN8fXZJjJvdu0VxRzf4k41xeRg3lO7I
IrWkkFCW0LSH
-----END CERTIFICATE-----
EOD;

    return openssl_verify($payload, base64_decode($signature_header_value), $klix_public_key, OPENSSL_ALGO_SHA256);
}
?>
<div class="highlight"><pre><span></span><code>```PHP tab=&quot;Klix PHP library&quot;
&lt;?php
use Klix\Callback\ProviderSignatureValidator;
use Klix\Callback\ProviderCallbackRequestDecoder;

$validator = new ProviderSignatureValidator($apiConfiguration);
$validator-&gt;isValid(payload, signature_header_value);
?&gt;
</code></pre></div>
<p>```Java tab=
import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;
import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;
import java.security.PublicKey;
import java.security.Signature;
import java.security.SignatureException;
import java.security.cert.CertificateException;
import java.security.cert.CertificateFactory;
import java.security.cert.X509Certificate;
import java.util.Base64;</p>
<p>private boolean isSignatureValid(String payload, String signatureHeaderValue) {
    byte[] decodedSignatureHeaderValue = Base64.getDecoder().decode(signatureHeaderValue);
    Signature signature = getSignature(payload);
    try {
        return signature.verify(decodedSignatureHeaderValue);
    } catch (SignatureException e) {
        throw new RuntimeException(e);
    }
}</p>
<p>private Signature getSignature(String payload) {
    PublicKey publicKey = loadPublicKey();
    try {
        Signature signature = Signature.getInstance("SHA256withRSA");
        signature.initVerify(publicKey);
        signature.update(payload.getBytes(StandardCharsets.UTF_8));
        return signature;
    } catch (NoSuchAlgorithmException | InvalidKeyException | SignatureException e) {
        throw new RuntimeException(e);
    }
}</p>
<p>private PublicKey loadPublicKey() {
    String klixPublicKey = "-----BEGIN CERTIFICATE-----\n" +
            "MIIB5TCCAY+gAwIBAgIENkY2rzANBgkqhkiG9w0BAQsFADBoMQswCQYDVQQGEwJM\n" +
            "VjEQMA4GA1UECBMHVW5rbm93bjEQMA4GA1UEBxMHVW5rbm93bjERMA8GA1UEChMI\n" +
            "Q2l0YWRlbGUxEDAOBgNVBAsTB1Vua25vd24xEDAOBgNVBAMTB1Vua25vd24wHhcN\n" +
            "MTgwNjEyMTMzNjM4WhcNMjgwNjA5MTMzNjM4WjBoMQswCQYDVQQGEwJMVjEQMA4G\n" +
            "A1UECBMHVW5rbm93bjEQMA4GA1UEBxMHVW5rbm93bjERMA8GA1UEChMIQ2l0YWRl\n" +
            "bGUxEDAOBgNVBAsTB1Vua25vd24xEDAOBgNVBAMTB1Vua25vd24wXDANBgkqhkiG\n" +
            "9w0BAQEFAANLADBIAkEAqAUyLiFAd4hxAh3LrbBrbqk+lmGPVFgS3996vTCQ/L/h\n" +
            "L9WnA+EPnxMV5LFyd49xsf5bbspaLrXnVmwkuvUC9wIDAQABoyEwHzAdBgNVHQ4E\n" +
            "FgQUzbA4JwE+SOUOJEd25iwpd9cajJMwDQYJKoZIhvcNAQELBQADQQBDtypgN8O3\n" +
            "AZ+H4CjH5Ihq+V5i/a3pL6nj8Dg502wejDN8fXZJjJvdu0VxRzf4k41xeRg3lO7I\n" +
            "IrWkkFCW0LSH\n" +
            "-----END CERTIFICATE-----";
    try (InputStream inputStream = new ByteArrayInputStream(klixPublicKey.getBytes())) {
        CertificateFactory fact = CertificateFactory.getInstance("X.509");
        X509Certificate certificate = (X509Certificate) fact.generateCertificate(inputStream);
        return certificate.getPublicKey();
    } catch (IOException | CertificateException e) {
        throw new RuntimeException(e);
    }
}
<div class="highlight"><pre><span></span><code>### Updating callback URLs

URLs can be set in Merchant Console settings.

![alt_text](images/callback_urls.png &quot;Callback URLs configuration in Merchant Console&quot;)

## Security

Every data modification request sent by merchant to Klix and every Klix widget order parameters should be signed by merchant private key and validated on Klix side by merchant public key.

### Transport-Level Security

All communication is going via HTTPS TLS 1.2 protocol.

### Certificates

Private and public key pairs are issued by Klix PKI (Public Key Infrastructure) server. It is possible to generate a new RSA 2048 key pair in Merchant Console -&gt; Certificates page. When clicking “GENERATE NEW CERTIFICATE” private key is downloaded to user machine, and public key is kept in Klix database.

![alt_text](images/merchant_console_generate_new_certificate.png &quot;Generate merchant certificate in Merchant Console&quot;)

Merchant RSA Key Pair generation guidelines:

* Each key pair is assigned a unique identifier in Klix database.
* Merchant private key is not stored in Klix and its responsibility of merchant to keep it secure.
* Key could be revoked by the merchant or Klix admin at any time.
* Multiple keys could be active at the same time. Widget attribute `certificate-name` helps to identify which key is used to sign particular order.
* Default Key expiration time is 2 calendar years. This is defined on PKI policies level.
* Notifications about key status changes (as well as expiration reminders) is sent to merchant email address.

Requests sent from Klix to merchant defined callback URL are also signed digitally using Klix private key and validated using public key, which is available in Merchant Console.

!!! Warning &quot;Storing private key&quot;
    Do not share your private key with anyone.

### Signing order

In order for Klix server to be able to verify a payment request origin Klix widget order parameters must be signed by merchant. Note that if your webshop is written in PHP you can use [Klix PHP library](https://github.com/klix-app/merchant-api-php#generate-widget-html-representation) to sign orders therefore following section can be skipped.

#### Signature generation

Order signature is generated by concatenating order fields into single string and applying SHA256 hash function and RSA encryption to it.
Order signature = `Base64Encode(SHA256withRSA(signature-input))`, where `signature-input` is calculated in a following way.
![Generate signature](images/signature-generation.svg &quot;Signature generation algorithm&quot;)
Note that all blank fields should be replaced with empty strings, all amount fields should be formatted with 2 decimals using dot as a decimal point and without thousand separator (e.g. if amount is 1025 then it should be formatted as 1025.00), count field should be formatted with 3 decimals (e.g. 2 should be formatted as 2.000).

#### Examples

Following private key is used in all examples. Note that you can obtain your merchant private key in Klix Merchant Console.

&lt;!-- markdownlint-disable MD033 --&gt;
&lt;details&gt;
    &lt;summary&gt;Expand to see a private key&lt;/summary&gt;

    ```txt
    -----BEGIN PRIVATE KEY-----
    MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDAom+89QBxPCJz
    lQP+PtVsJrdl7wJq2Nj2crBDyNyZjIZcCaf7CCLRD43VCwsFjGSGoWhYDwbWAWzy
    ryi6bwcaXdWg8p/pHoWTP3sHluVaHQx6fh3xHsb2qgSE320JtvEYJC3k0RwQyt7j
    MEhN79Dizxj2fsMl9nv2fe1/8WwEudtaJl2o+iEQvhz9p2XR106AOU8+DesOt/1X
    9wGmQKpxffOLbq0WpYzXw7U5R41Zk9atusRi+CP5FAhKvdRQu9zv18vU2Mv2CdHl
    Dxe/Z+dpm3iFbBFKVPRMFHzBE4tYQ49YfHrxTob6rHbv1MoyGW01FgVhW989Caq2
    Sa60iV4XAgMBAAECggEAYG7w0P81gXpBJOtsXFLINKQNG5JS+3oi4vz3EHf1N0kJ
    2flbhmfERjQrJIOquNRXXq5etfaPzYJZMARPt0TtoV1oHHJZazJEXDpjNKFtn3b7
    UDbidlqZ79GdAYd35m0WtKcn8mxcSGvGuKTrDVkIkQJr1LoQp2iFFhhkVLBfCt3A
    W13MeCq4fcu5CHj7ZHExpgTkyO+o4cKCU+XqBMiN0xl2yt8BeFVpyuK0bxMs8yjb
    budT5mhA+pQYYLblS/S+ONYFhQZdvwyCUDcpmDwQc5oUCyJISPvT618cAL9/WfWU
    YhDjPZ1LDkiGcP6KWyEp4TCupMOCDQ6KoKdbfEdHAQKBgQD13sE1E5327ZnuqmYD
    4c+zD4c3duXi9ZqoD/ZYV9XwiER2XnMKMbDDztaPiBZVd5gy60I7uLXs/7elQ02D
    zla+vIew44ZgZUFuNnVCooT5MEGIrI6lyZEy7wOiMSSQsw60wbsDAqWqNZm63wbf
    fizIpvc3ELxXXDfqfgBpM1GJJwKBgQDIkjG4/E2dXhlUDxKozwi+5y/61Ir1jBKg
    c7KF5BbO61o/J7GxUcUDtf4Rw9wqaYWrcIycyIB0wGQKuWomadi1uM3m63x44cqQ
    RzcwUZckiQv465rpct/exXoq5xy8JdLMi9pVjGaAKtvDy1moVVMqf44704JTYBjK
    pqLRPkc5kQKBgFBh3SSvHyvFjlfa2bNXNgJCh2B4vLuwtDlRzqYfQVB8HHXedxnU
    GQhLLRaL1VFn4hhzlZnUz5WGHNIo6MS4xt9g37PTDvGg6P1RTJDWdUbKogI+9/v3
    pELUpYl3K48rGxm5ZJydVvAIyhOwKp0SsS2AeL5F+G1PNvCw9Q1vu65tAoGAGeNc
    zZ6rOfOqW0Iyy10lqNZYSAzk/rqcsN8eHNAK7ZxNIrex5MxEHK2B5LMeGM9T9IPr
    clUi1275urSh8eFZmmMHGJYuk7+5EJRQmEj/tDSIOhHXBejQ4oUktqLr/5D2O3aV
    sNMVa9ecVBJMOUECIgsixbAQM0jFCmslutJKCTECgYA+SCrepQmwfQF47I+wVHDf
    81Hvh3/WqeFaaXt12kvEk2DDdG9PYvEuqtEFalvH/5LcsWDiknA1zdo9pXLIg95N
    SY5hDphsXnZLaYS9V9uaW7RCC4VpWELxoVG13mtGDnteAIgoxwWIQ6TfhidFpVtM
    2KcJhf0hnLkFQW0qEMn0vg==
    -----END PRIVATE KEY-----
    ```
&lt;/details&gt;
&lt;!-- markdownlint-disable MD033 --&gt;

##### Example No 1: Klix Pay widget with single order item

Consider Klix widget for following order should be placed in merchant webshop:

```html
&lt;klix-checkout widget-id=&quot;21ca7904-ff16-48b5-918d-c2d80af81f05&quot;  
    amount=&quot;5.45&quot;  
    currency=&quot;EUR&quot;  
    order-id=&quot;12345678&quot;  
    label=&quot;Order No 12345678&quot;  
    language=&quot;lv&quot;
    back-to-merchant-url=&quot;https://example.com/shopping-cart&quot;
    signature=&quot;n0b7Sj0qEVlU52kNctEHR9zUZ9pRtPjA/5/avPSQamx7HiI3q6qijgstBw6KhOKZqcCIL3RULbWNu6xoSGnNtW/nx+RcSd12I0st21Los9MXXPakEIjIto+2Zx0+ZiVoa97dxO8/iGF5A1U4qW9GFhPJGPqQecmZSp7rYaiO+VRq5D9KqKqRpBQEYN9YJgDgWMn36KVYkTdlOYAhJslwkVeKKZ+/ifUqHhiXbPKD3VKAXwx7/MqSiRlfU8Qsm7Vcv/zV05X9trZiaSYOL6yd9aWO/KE2so2hAswY58i6dR218/XD6ab5xTpCSXrfjYbfhInchukvlH7CrbE1T3RcWw==&quot;&gt;
&lt;/klix-checkout&gt;
</code></pre></div></p>
<p>Steps to calculate a signature:</p>
<ol>
<li>
<p>Calculate signature input string. <code>Input string = CONCAT(widget ID, language, back to merchant URL, amount, currency, label) = 21ca7904-ff16-48b5-918d-c2d80af81f05lvhttps://example.com/shopping-cart123456785.45EUROrder No 12345678</code>. Note that fields without a value e.g. certificate name, success URL, unit, count are not included in signature input string.</p>
</li>
<li>
<p>Calculate signature using private key previously downloaded from Klix Merchant Console and applying SHA256withRSA and Base64Encode functions to calculated input string. <code>Signature = Base64Encode(SHA256withRSA(signature-input)) = Base64Encode(SHA256withRSA("21ca7904-ff16-48b5-918d-c2d80af81f05lvhttps://example.com/shopping-cart123456785.45EUROrder No 12345678"))</code>.</p>
</li>
</ol>
<p>Calculated signature which should be passed to Klix widget as a <code>signature</code> attribute value in this example: <code>ebSnfsTOV2v0zwXxk8YVYjH6iYTfkYA+tn+ove9I+0Zi3lgQ+Mhc6sNJJlhqaSa6hqODZJKGGOCy/d2sqB86dIcJd2M3wB1MqHtVTNadCR+V3gHi+ORTcAQmX/c7crU0lLiKwfHSvaE7FlZUG9cU8ErcZfWDAJEtOMWncMl/yIeec1kPwb302mFzZUsXkVi8/VPp70k9oIh+vPvew/vVTGhoS2ClnFx4heezp1BNXYxZZsFoSgYFP555tNsHYi4GY6DOIx0qrUtmRrWCrt8HjWV7hBFPDNOQnQ05vALLcWtzWdDtGIo5a46HrlW2biCXW3R6K9jW/FxhsEVvwT7fDQ==</code>.</p>
<h5 id="example-no-2-klix-checkout-widget-with-multiple-order-items-and-order-delivery">Example No 2: Klix Checkout widget with multiple order items and order delivery<a class="headerlink" href="#example-no-2-klix-checkout-widget-with-multiple-order-items-and-order-delivery" title="Permanent link">&para;</a></h5>
<p>Consider Klix widget for following order should be placed in merchant webshop:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;8c597447-5234-4de1-ab85-b54e252098ce&quot;</span> 
    <span class="na">language</span><span class="o">=</span><span class="s">&quot;lv&quot;</span>
    <span class="na">order</span><span class="o">=</span><span class="s">&quot;{&amp;quot;items&amp;quot;: [{&amp;quot;orderItemId&amp;quot;: &amp;quot;12345&amp;quot;, &amp;quot;amount&amp;quot;: 88, &amp;quot;taxRate&amp;quot;: 0.21, &amp;quot;currency&amp;quot;: &amp;quot;EUR&amp;quot;, &amp;quot;label&amp;quot;: &amp;quot;Vacuum cleaner TP-3&amp;quot;}, {&amp;quot;amount&amp;quot;: 9.39, &amp;quot;currency&amp;quot;: &amp;quot;EUR&amp;quot;, &amp;quot;label&amp;quot;: &amp;quot;TP-3 HEPA filter&amp;quot;,&amp;quot;count&amp;quot;: 2, &amp;quot;unit&amp;quot;: &amp;quot;PIECE&amp;quot;}], &amp;quot;shippingOptions&amp;quot;: [{&amp;quot;id&amp;quot;:&amp;quot;omniva&amp;quot;,&amp;quot;amount&amp;quot;:2,&amp;quot;currency&amp;quot;:&amp;quot;EUR&amp;quot;,&amp;quot;taxRate&amp;quot;: 0.21},  {&amp;quot;id&amp;quot;:&amp;quot;courier&amp;quot;,&amp;quot;amount&amp;quot;:0}]}&quot;</span>
    <span class="na">signature</span><span class="o">=</span><span class="s">&quot;DJNg/BEiWk6+9CR/wD6P2gbK1+LtAtB0wuqZEelc3tj22/8uVgiTLJ1bj6/H5AhMIiIzI7mIDAFTSc5l+BHZPM7Z/BAXU6mLrbqQUQ6apKmNcjDIDL+NQnZEVb3PCcLRO+IR5tRJLnTcJXVYBDwLlYfvK7INFLwz/4pvklGQOa/ZSHdMLsR5aHLpvfgm6gTlMszV63k8NxCgFghN6B6xdftcdQPskzEYXdpqn+++40bbYv3hReA1zaOCDupjrJirYcNP3P+f6V7t1MLkQqX2pqh3TJEkorrJH/0e1WMbHUdQY6NiJcsMN56qEntdQI6GiUQVNtwOj8sH9kMMdgdjbg==&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
</code></pre></div>
<p>Note that character <code>"</code> values are escaped in a JSON document passed as <code>order</code> attribute value.  </p>
<!-- markdownlint-disable MD033 -->
<details>
    <summary>Expand to see an unescaped and formatted order attribute value</summary>
    <div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;items&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="nt">&quot;orderItemId&quot;</span><span class="p">:</span><span class="s2">&quot;12345&quot;</span><span class="p">,</span>
            <span class="nt">&quot;amount&quot;</span><span class="p">:</span><span class="mi">88</span><span class="p">,</span>
            <span class="nt">&quot;taxRate&quot;</span><span class="p">:</span><span class="mf">0.21</span><span class="p">,</span>
            <span class="nt">&quot;currency&quot;</span><span class="p">:</span><span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
            <span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;Vacuum cleaner TP-3&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;amount&quot;</span><span class="p">:</span><span class="mf">9.39</span><span class="p">,</span>
            <span class="nt">&quot;currency&quot;</span><span class="p">:</span><span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
            <span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="s2">&quot;TP-3 HEPA filter&quot;</span><span class="p">,</span>
            <span class="nt">&quot;count&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;unit&quot;</span><span class="p">:</span><span class="s2">&quot;PIECE&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;shippingOptions&quot;</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;omniva&quot;</span><span class="p">,</span>
            <span class="nt">&quot;amount&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;currency&quot;</span><span class="p">:</span><span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
            <span class="nt">&quot;taxRate&quot;</span><span class="p">:</span><span class="mf">0.21</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;courier&quot;</span><span class="p">,</span>
            <span class="nt">&quot;amount&quot;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
</details>
<!-- markdownlint-disable MD033 -->

<p>Steps to calculate a signature:</p>
<ol>
<li>
<p>Calculate signature input string. <code>Input string = CONCAT(widget ID, language, first order item amount, first order item currency, first order item label, first order item tax rate, first order item id, second order item amount, second order item currency, second order item label, second order item count, second order item unit, first shipping option id, first shipping option amount, first shipping option currency, second shipping option id, second shipping option amount) = 8c597447-5234-4de1-ab85-b54e252098celv88.00EURVacuum cleaner TP-30.21123459.39EURTP-3 HEPA filter2PIECEomniva2.00EURcourier0.00</code>. Note that fields without a value are not included in signature input string.</p>
</li>
<li>
<p>Calculate signature using private key previously downloaded from Klix Merchant Console and applying SHA256withRSA and Base64Encode functions to calculated input string. <code>Signature = Base64Encode(SHA256withRSA(signature-input)) = Base64Encode(SHA256withRSA("8c597447-5234-4de1-ab85-b54e252098celv88.00EURVacuum cleaner TP-30.21123459.39EURTP-3 HEPA filter2PIECEomniva2.00EURcourier0.00"))</code>.</p>
</li>
</ol>
<p>Calculated signature which should be passed to Klix widget as a <code>signature</code> attribute value in this example: <code>DJNg/BEiWk6+9CR/wD6P2gbK1+LtAtB0wuqZEelc3tj22/8uVgiTLJ1bj6/H5AhMIiIzI7mIDAFTSc5l+BHZPM7Z/BAXU6mLrbqQUQ6apKmNcjDIDL+NQnZEVb3PCcLRO+IR5tRJLnTcJXVYBDwLlYfvK7INFLwz/4pvklGQOa/ZSHdMLsR5aHLpvfgm6gTlMszV63k8NxCgFghN6B6xdftcdQPskzEYXdpqn+++40bbYv3hReA1zaOCDupjrJirYcNP3P+f6V7t1MLkQqX2pqh3TJEkorrJH/0e1WMbHUdQY6NiJcsMN56qEntdQI6GiUQVNtwOj8sH9kMMdgdjbg==</code>.</p>
<h2 id="klix-widget">Klix Widget<a class="headerlink" href="#klix-widget" title="Permanent link">&para;</a></h2>
<h3 id="klix-widget-placement">Klix Widget placement<a class="headerlink" href="#klix-widget-placement" title="Permanent link">&para;</a></h3>
<p>Klix Widget is implemented as embeddable Web Component. In order to show Klix widget on a merchant website widget JavaScript should be included in the page and custom HTML tag needs to be placed in the required location. See the example below for integration code.</p>
<div class="admonition warning">
<p class="admonition-title">Widget JavaScript location</p>
<p>Please note that Klix Widget JavaScript source should be loaded from different destination in case of production and test environments. Test environment Klix Widget JavaScript base path is  <code>https://klix.blob.core.windows.net/stage/widget/build/</code>. Production environment Klix Widget JavaScript base path is <code>https://klix.blob.core.windows.net/public/widget/build/</code>.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;module&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://klix.blob.core.windows.net/stage/widget/build/klixwidget.esm.js&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">nomodule</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://klix.blob.core.windows.net/stage/widget/build/klixwidget.js&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    KLIX embedded checkout:
    <span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">language</span><span class="o">=</span><span class="s">&quot;lv&quot;</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;604419cc-c313-4e47-93e8-330385669bdb&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</code></pre></div>
<p>Integration code can be accessed and copied from Widgets section of Merchant Console.</p>
<h3 id="widget-configuration">Widget Configuration<a class="headerlink" href="#widget-configuration" title="Permanent link">&para;</a></h3>
<p>Klix widget is created and configured in <em>Merchant Console</em>. Generated <em>Widget ID</em> is used to embed Web Component into Merchant HTML page.</p>
<h4 id="specifying-widget-language">Specifying widget language<a class="headerlink" href="#specifying-widget-language" title="Permanent link">&para;</a></h4>
<p>Widget language can be specified using attribute <em>language</em> e.g. "lv" for Latvian, "en" for English or "ru" for Russian.</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">language</span><span class="o">=</span><span class="s">&quot;lv&quot;</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;604419cc-c313-4e47-93e8-330385669bdb&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="prefilling-klix-widget-form-data">Prefilling Klix widget form data<a class="headerlink" href="#prefilling-klix-widget-form-data" title="Permanent link">&para;</a></h4>
<p>Klix widget form data prefilling allows to reduce a number of fields that needs to be entred by customer in Klix form in situations where required customer information was previously entered in merchant's webpage e.g. in case if Klix form is presented to exsiting merchant's customer or customer needs to fill specific form on merchant's page before continuing with Klix form.</p>
<p>Klix widget supports prefilling form with customer data specified as Klix widget attributes. Customer phone number, e-mail, first name and last name can be passed to widget:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">language</span><span class="o">=</span><span class="s">&quot;lv&quot;</span> <span class="na">email</span><span class="o">=</span><span class="s">&quot;john.doe@klix.app&quot;</span> <span class="na">phone</span><span class="o">=</span><span class="s">&quot;37120000000&quot;</span> <span class="na">first-name</span><span class="o">=</span><span class="s">&quot;John&quot;</span> <span class="na">last-name</span><span class="o">=</span><span class="s">&quot;Doe&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
</code></pre></div>
<p>Note that partial data prefill is supported i.e. if only firstname and last name of customer is passed to Klix widget it will be prefilled after non existing Klix customer enters his mobile phone number.</p>
<p>In case there's no Klix customer with specified mobile phone number Klix widget form will be prefilled with specified data.</p>
<p><img alt="New customer data prefilled in widget" src="../images/widget_new_customer_data_prefilled.png" title="New customer data prefilled in widget" /></p>
<p>Otherwise Klix widget data autofill is triggered automatically so that customer receives autofill notifcation in his mobile phone.</p>
<p><img alt="Existing customer data prefilled in widget" src="../images/widget_existing_customer_data_prefilled.png" title="Existing customer data prefilled in widget" /></p>
<h3 id="instant-fixed-price-widget-type">INSTANT (Fixed Price) Widget Type<a class="headerlink" href="#instant-fixed-price-widget-type" title="Permanent link">&para;</a></h3>
<p>It is possible to generate Klix widget for a specific order. In this case no validation on merchant side is required - all order items are defined at widget configuration in Merchant Console (MC). They can’t be overwritten by <em>Widget HTML API</em> or <em>Widget JS API</em> (specified later in the document) for security purposes. This type of Widget allows lightweight integration with merchant - no merchant back-end is required for integration.</p>
<p>Widget language is specified either in page <em><html></em> tag or as a Klix widget attribute.</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;lv&quot;</span><span class="p">&gt;</span>
...
<span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
</code></pre></div>
<p>OR</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">language</span><span class="o">=</span><span class="s">&quot;lv&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
</code></pre></div>
<h3 id="checkout-dynamic-price-widget-type">CHECKOUT (Dynamic Price) Widget Type<a class="headerlink" href="#checkout-dynamic-price-widget-type" title="Permanent link">&para;</a></h3>
<p>Order items should be provided either via <em>Widget HTML API</em> (widget tag attributes) or via <em>Widget JS API</em>. Widget language is defined in the same manner as in <em>Fixed Price Widget</em> type.</p>
<h4 id="html-api-for-single-order-item">HTML API for single order item<a class="headerlink" href="#html-api-for-single-order-item" title="Permanent link">&para;</a></h4>
<p>Tax could be defined as rate (0.XX) or percentage (number greater than 1 without ‘%’ symbol).</p>
<p>Tax rate default value is merchant specific (e.g. for merchants registered in LV it would be "0.21"). Currency default value is merchant specific as well (e.g. for merchants registered in EU it would be "EUR").</p>
<p>All HTML widgets below are equivalent for merchant registered in LV:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">amount</span><span class="o">=</span><span class="s">&quot;1.99&quot;</span> <span class="na">currency</span><span class="o">=</span><span class="s">&quot;EUR&quot;</span> <span class="na">label</span><span class="o">=</span><span class="s">&quot;Philips XR3857&quot;</span> <span class="na">tax-rate</span><span class="o">=</span><span class="s">&quot;0.21&quot;</span> <span class="na">count</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="na">unit</span><span class="o">=</span><span class="s">&quot;PIECE&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">amount</span><span class="o">=</span><span class="s">&quot;1.99&quot;</span> <span class="na">currency</span><span class="o">=</span><span class="s">&quot;EUR&quot;</span> <span class="na">label</span><span class="o">=</span><span class="s">&quot;Philips XR3857&quot;</span> <span class="na">tax-rate</span><span class="o">=</span><span class="s">&quot;21&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">amount</span><span class="o">=</span><span class="s">&quot;1.99&quot;</span> <span class="na">currency</span><span class="o">=</span><span class="s">&quot;EUR&quot;</span> <span class="na">label</span><span class="o">=</span><span class="s">&quot;Philips XR3857&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">amount</span><span class="o">=</span><span class="s">&quot;1.99&quot;</span> <span class="na">label</span><span class="o">=</span><span class="s">&quot;Philips XR3857&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="html-api-for-multiple-order-items">HTML API for multiple order items<a class="headerlink" href="#html-api-for-multiple-order-items" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">order</span><span class="o">=</span><span class="s">&#39;{&quot;items&quot;:[{&quot;amount&quot;:40,&quot;currency&quot;:&quot;EUR&quot;,&quot;count&quot;:2,&quot;unit&quot;:&quot;PIECE&quot;,&quot;label&quot;:&quot;Philips XR3857&quot;,&quot;taxRate&quot;:0.21},{&quot;amount&quot;:5,&quot;label&quot;:&quot;Piegāde&quot;}]}&#39;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
</code></pre></div>
<p>OR</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">order</span><span class="o">=</span><span class="s">&quot;{&amp;quot;items&amp;quot;:[{&amp;quot;amount&amp;quot;:40,&amp;quot;currency&amp;quot;:&amp;quot;EUR&amp;quot;,&amp;quot;count&amp;quot;:2,&amp;quot;label&amp;quot;:&amp;quot;Philips XR3857&amp;quot;,&amp;quot;taxRate&amp;quot;:0.21},{&amp;quot;amount&amp;quot;:5,&amp;quot;label&amp;quot;:&amp;quot;Piegāde&amp;quot;}]}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
</code></pre></div>
<p>Also product name value needs to be properly escaped (e.g. using <code>&amp;amp;</code> for <code>&amp;</code>, <code>&amp;lt;</code> for <code>&lt;</code>, <code>&amp;#39;</code> for <code>'</code>, <code>&amp;#34;</code> for <code>"</code>, etc.) to be a valid HTML attribute value.</p>
<h5 id="implementation-details">Implementation details<a class="headerlink" href="#implementation-details" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="c1">// merchant order</span>
<span class="kd">let</span> <span class="nx">orderObject</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;items&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="o">:</span><span class="mf">40</span><span class="p">,</span><span class="s2">&quot;currency&quot;</span><span class="o">:</span><span class="s2">&quot;EUR&quot;</span><span class="p">,</span><span class="s2">&quot;label&quot;</span><span class="o">:</span><span class="s2">&quot;Philips XR3857&quot;</span><span class="p">,</span><span class="s2">&quot;taxRate&quot;</span><span class="o">:</span><span class="mf">0.21</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="o">:</span><span class="mf">5</span><span class="p">,</span><span class="s2">&quot;label&quot;</span><span class="o">:</span><span class="s2">&quot;Piegāde&quot;</span><span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;shippingOptions&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="s2">&quot;pickup&quot;</span><span class="p">,</span><span class="s2">&quot;amount&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="s2">&quot;omniva&quot;</span><span class="p">,</span><span class="s2">&quot;amount&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">,</span><span class="s2">&quot;currency&quot;</span><span class="o">:</span><span class="s2">&quot;EUR&quot;</span><span class="p">,</span><span class="s2">&quot;taxRate&quot;</span><span class="o">:</span><span class="mf">0.21</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="s2">&quot;latvijaspasts&quot;</span><span class="p">}]</span>
<span class="p">};</span>

<span class="c1">// this value goes into widget &#39;order&#39; attribute</span>
<span class="kd">let</span> <span class="nx">orderAttribute</span> <span class="o">=</span> <span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">orderObject</span><span class="p">);</span>

<span class="c1">// this value goes into HTML attribute (e.g. client side templating)</span>
<span class="kd">let</span> <span class="nx">escaped</span> <span class="o">=</span> <span class="nx">orderAttribute</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;amp;&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;#39;&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;#34;&#39;</span><span class="p">);</span>

<span class="c1">// this value is received as widget internal state</span>
<span class="kd">let</span> <span class="nx">orderObjectInWidget</span> <span class="o">=</span> <span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">orderAttribute</span><span class="p">);</span>
</code></pre></div>
<h4 id="js-api-for-single-and-multiple-order-items">JS API for single and multiple order items<a class="headerlink" href="#js-api-for-single-and-multiple-order-items" title="Permanent link">&para;</a></h4>
<p>Widget <code>'lazy'</code> attribute is used to delay widget initialization (until configuration via <em>Widget JS API</em> is completed):</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;my-klix-checkout&quot;</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">lazy</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
...
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="kd">let</span> <span class="nx">checkoutWidget</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#my-klix-checkout&#39;</span><span class="p">);</span>
  <span class="nx">checkoutWidget</span><span class="p">.</span><span class="nx">addOrderItem</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="o">:</span><span class="mf">40</span><span class="p">,</span><span class="s2">&quot;currency&quot;</span><span class="o">:</span><span class="s2">&quot;EUR&quot;</span><span class="p">,</span><span class="s2">&quot;label&quot;</span><span class="o">:</span><span class="s2">&quot;Philips XR3857&quot;</span><span class="p">,</span><span class="s2">&quot;count&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">,</span><span class="s2">&quot;unit&quot;</span><span class="o">:</span><span class="s2">&quot;PIECE&quot;</span><span class="p">,</span><span class="s2">&quot;taxRate&quot;</span><span class="o">:</span><span class="mf">0.21</span><span class="p">});</span>
  <span class="nx">checkoutWidget</span><span class="p">.</span><span class="nx">addOrderItem</span><span class="p">({</span><span class="s2">&quot;amount&quot;</span><span class="o">:</span><span class="mf">5</span><span class="p">,</span><span class="s2">&quot;label&quot;</span><span class="o">:</span><span class="s2">&quot;Piegāde&quot;</span><span class="p">});</span>

  <span class="c1">// pick-up at store, free of charge </span>
  <span class="nx">checkoutWidget</span><span class="p">.</span><span class="nx">addShippingOption</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="s2">&quot;pickup&quot;</span><span class="p">,</span><span class="s2">&quot;amount&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">});</span>

  <span class="c1">// shipping price is unknown, separate request will be initiated</span>
  <span class="c1">// for entered (by customer) address via Merchant API</span>
  <span class="nx">checkoutWidget</span><span class="p">.</span><span class="nx">addShippingOption</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="s2">&quot;latvijaspasts&quot;</span><span class="p">});</span>

  <span class="c1">// shipping price (before tax) and tax rate are known for</span>
  <span class="c1">// given product/cart (whatever selected address or pickup point)</span>
  <span class="nx">checkoutWidget</span><span class="p">.</span><span class="nx">addShippingOption</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="s2">&quot;myIdForPickupProvider&quot;</span><span class="p">,</span>
    <span class="s2">&quot;amount&quot;</span><span class="o">:</span><span class="mf">5</span><span class="p">,</span><span class="s2">&quot;currency&quot;</span><span class="o">:</span><span class="s2">&quot;EUR&quot;</span><span class="p">,</span><span class="s2">&quot;taxRate&quot;</span><span class="o">:</span><span class="mf">0.21</span><span class="p">});</span>

  <span class="nx">checkoutWidget</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div>
<h4 id="order-item-attributes">Order Item attributes<a class="headerlink" href="#order-item-attributes" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Mandatory</th>
<th>Default value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>amount</td>
<td>Yes</td>
<td>n/a</td>
<td>Price per unit</td>
</tr>
<tr>
<td>currency</td>
<td>No</td>
<td>Merchant specific (EUR in Latvia)</td>
<td>Alphabetic code ISO 4217</td>
</tr>
<tr>
<td>label</td>
<td>Yes</td>
<td>n/a</td>
<td>Product or service name</td>
</tr>
<tr>
<td>count</td>
<td>No</td>
<td>1</td>
<td>Quantity</td>
</tr>
<tr>
<td>unit</td>
<td>No</td>
<td>PIECE</td>
<td>{PIECE, KILOGRAM, METER, LITRE, HOUR}</td>
</tr>
<tr>
<td>taxRate</td>
<td>No</td>
<td>Merchant specific (0.21 in Latvia)</td>
<td>VAT</td>
</tr>
<tr>
<td>orderItemId</td>
<td>No</td>
<td>null</td>
<td>Product ID in merchant system for reference purposes</td>
</tr>
</tbody>
</table>
<h3 id="javascript-callbacks">Javascript callbacks<a class="headerlink" href="#javascript-callbacks" title="Permanent link">&para;</a></h3>
<p>Klix widget uses <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Creating_and_triggering_events">Custom DOM events</a> to communicate with merchant page. In order to listen specifc Klix widget event appropriate event listener should be registered first.</p>
<h4 id="payment-completed-callback">Payment completed callback<a class="headerlink" href="#payment-completed-callback" title="Permanent link">&para;</a></h4>
<p>Event with type <code>paymentCompleted</code> is published in case of successfull or failed payment right before payment status screen is shown to customer.</p>
<p><img alt="Klix widget payment status screen" src="../images/widget_payment_status.png" title="Klix widget payment status screen" /></p>
<p>Event handler can be used to dynamically update merchant page contents according to payment processing result.</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">order</span><span class="o">=</span><span class="s">&quot;...&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">const</span> <span class="nx">checkoutElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;klix-checkout&#39;</span><span class="p">);</span>
    <span class="nx">checkoutElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;paymentCompleted&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;Order with id &#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">[</span><span class="s2">&quot;orderId&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; payment succeeded -&gt; &#39;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">[</span><span class="s2">&quot;paymentSucceeded&quot;</span><span class="p">];</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
        <span class="c1">// Note that this callback can be used to hide Klix default payment success screen and show your own instead</span>
        <span class="cm">/*</span>
<span class="cm">        if (event.detail[&quot;paymentSucceeded&quot;]) {</span>
<span class="cm">          checkoutElement.remove();  </span>
<span class="cm">          // display your own payment success message</span>
<span class="cm">        }</span>
<span class="cm">        */</span>

    <span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div>
<p>Following event properties can be used:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>event.detail["orderId"]</td>
<td>string</td>
<td>Completed payment order identifier</td>
</tr>
<tr>
<td>event.detail["paymentSucceeded"]</td>
<td>boolean</td>
<td>Indicates if payment succeeded or failed</td>
</tr>
</tbody>
</table>
<h4 id="navigate-back-to-payment-method-selection-shopping-cart-page">Navigate back to payment method selection / shopping cart page<a class="headerlink" href="#navigate-back-to-payment-method-selection-shopping-cart-page" title="Permanent link">&para;</a></h4>
<p>Event with type <code>navigateBackToCart</code> is published in case if customer presses "Back to merchant store" button on cancelled/failed payment Klix widget form.</p>
<!-- markdownlint-disable MD033 -->
<p style="text-align: center;">
  <img src="../images/widget_failed_payment.png" width="500" alt="Failed/cancelled payment screen" />
</p>

<p>Event handler should point browser to checkout or payment method selection page so that customer can use another payment method if available.</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">order</span><span class="o">=</span><span class="s">&quot;...&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">const</span> <span class="nx">checkoutElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;klix-checkout&#39;</span><span class="p">);</span>
    <span class="nx">checkoutElement</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;navigateBackToCart&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">=</span> <span class="s1">&#39;/shopping-cart&#39;</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div>
<h3 id="limiting-accepted-cards">Limiting accepted cards<a class="headerlink" href="#limiting-accepted-cards" title="Permanent link">&para;</a></h3>
<p>By default all cards issued by Mastercard and VISA are accepted by Klix however following constraints can be imposed via order configuration if needed:</p>
<table>
<thead>
<tr>
<th>Constraint</th>
<th>Configuration example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Accepted card issuer</td>
<td><code>"constraints": {"issuer": "Citadele"}</code></td>
<td>Only cards issued by Citadele bank are accepted for this payment</td>
</tr>
<tr>
<td>Accepted card brand</td>
<td><code>"constraints": {"brand": "X karte"}</code></td>
<td>Only Citadele "X karte" brand cards are accepted for this payment</td>
</tr>
<tr>
<td>Accepted card payment scheme</td>
<td><code>"constraints": {"paymentScheme": "VISA"}</code></td>
<td>Only VISA cards are accepted for this payment</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">klix-checkout</span> <span class="na">widget-id</span><span class="o">=</span><span class="s">&quot;...&quot;</span> <span class="na">order</span><span class="o">=</span><span class="s">&quot;{&amp;quot;constraints&amp;quot;:{&amp;quot;issuer&amp;quot;:&amp;quot;Citadele&amp;quot;},&amp;quot;items&amp;quot;:[{&amp;quot;amount&amp;quot;:40,&amp;quot;currency&amp;quot;:&amp;quot;EUR&amp;quot;,&amp;quot;count&amp;quot;:2,&amp;quot;label&amp;quot;:&amp;quot;Philips XR3857&amp;quot;,&amp;quot;taxRate&amp;quot;:0.21}]}&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">klix-checkout</span><span class="p">&gt;</span>
</code></pre></div>
<h2 id="client-libraries">Client libraries<a class="headerlink" href="#client-libraries" title="Permanent link">&para;</a></h2>
<p>Klix team maintains official API client libraries which wraps Klix API invocations including request signing and response signature validation.</p>
<p>If you have implemented client library for programming language or popular framework that's not listed here then let us know it so that we might share it with others.</p>
<h3 id="available-libraries">Available libraries<a class="headerlink" href="#available-libraries" title="Permanent link">&para;</a></h3>
<h4 id="php">PHP<a class="headerlink" href="#php" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="https://github.com/klix-app/merchant-api-php">Github</a></li>
<li><a href="https://packagist.org/packages/klix-app/merchant-api-php">Packagist</a></li>
</ul>
<h2 id="integration-testing">Integration testing<a class="headerlink" href="#integration-testing" title="Permanent link">&para;</a></h2>
<h3 id="environments">Environments<a class="headerlink" href="#environments" title="Permanent link">&para;</a></h3>
<p>Klix provides a fully functional test environment that can be used to test Klix integration implementation without a need to use real bank cards or make actual transactions. Follow instructions in the <a href="#step-by-step-integration-instructions">step by step guide</a> to receive access to test both Merchant Console and API.</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Test environment</th>
<th>Production environment</th>
</tr>
</thead>
<tbody>
<tr>
<td>Merchant Console</td>
<td><sub>https://mc.stage.klix.app</sub></td>
<td><sub>https://mc.klix.app</sub></td>
</tr>
<tr>
<td>Merchant API</td>
<td><sub>https://api.stage.klix.app</sub></td>
<td><sub>https://api.klix.app</sub></td>
</tr>
<tr>
<td>Widget Javascript base path</td>
<td><sub>https://klix.blob.core.windows.net/stage/widget/build/</sub></td>
<td><sub>https://klix.blob.core.windows.net/public/widget/build/</sub></td>
</tr>
</tbody>
</table>
<h3 id="test-environment-bank-cards">Test environment bank cards<a class="headerlink" href="#test-environment-bank-cards" title="Permanent link">&para;</a></h3>
<p>Test environment is not connected to real bank card issuer networks therefore only special test cards can be used in test environment.</p>
<table>
<thead>
<tr>
<th>Issuer</th>
<th>PAN</th>
<th>CVV</th>
<th>Expiry date</th>
<th>3D secure password</th>
</tr>
</thead>
<tbody>
<tr>
<td>VISA</td>
<td>4314 2200 0000 0056</td>
<td>123</td>
<td>01/22</td>
<td>hint</td>
</tr>
<tr>
<td>MASTERCARD</td>
<td>5413 3300 0000 0019</td>
<td>589</td>
<td>01/22</td>
<td>hint</td>
</tr>
</tbody>
</table>
<p>Note that any cardholder name can be used with these cards.</p>
<h2 id="merchant-api-v2">Merchant API v2<a class="headerlink" href="#merchant-api-v2" title="Permanent link">&para;</a></h2>
<p>Klix provides merchant API that can be used to perform various operations with orders e.g. retrieve order by identifier, fully or partially refund an order payment transaction, etc. Note that Klix currently does not provide an API to make a payment without interacting with Klix Widget.</p>
<h3 id="swagger-documentation">Swagger documentation<a class="headerlink" href="#swagger-documentation" title="Permanent link">&para;</a></h3>
<p>Up to date Klix Merchant API <a href="https://swagger.io/">Swagger</a> documentation is available <a href="https://api.stage.klix.app/v2/merchants">here</a> and can be previewed using Swagger Inspector <a href="https://inspector.swagger.io/builder?url=https%3A%2F%2Fapi.stage.klix.app%2Fv2%2Fmerchants">online</a>.</p>
<h3 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h3>
<h4 id="authentication-method">Authentication method<a class="headerlink" href="#authentication-method" title="Permanent link">&para;</a></h4>
<p>All requests sent to Klix Merchant API should be digitally signed using merchant certificate generated in Klix Merchant Console. Signing process is performed according to <a href="https://www.ietf.org/archive/id/draft-cavage-http-signatures-12.txt">"Draft cavage HTTP Signatures"</a> specification.
Request signature is sent as an HTTP <code>Authorization</code> header value together with metadata describing signature algorithm and certificate key used.</p>
<h4 id="signing-requests-without-request-body">Signing requests without request body<a class="headerlink" href="#signing-requests-without-request-body" title="Permanent link">&para;</a></h4>
<p>The following HTTP headers should be sent for all requests without a request body: Authorization, Date.
Signed HTTP GET request example:</p>
<div class="highlight"><pre><span></span><code>curl -X GET <span class="se">\</span>
  https://api.stage.klix.app/v2/merchants/052eb290-a6ca-41f0-aac5-fd4ca14632e3/orders/a6f0f3c7-e3e7-4182-bc4c-bddec2a89d9a <span class="se">\</span>
  -H <span class="s1">&#39;Authorization: Signature keyId=&quot;ad537135-59f5-4073-8f8e-1137fc19b9d2&quot;,algorithm=&quot;rsa-sha256&quot;,headers=&quot;date (request-target)&quot;,signature=&quot;xkdqOeB0Iy4iaSQRgIWsyCuSewMzOcDISMdKO6ThFiRrvZXxdVnW1xY6WZH8E3y2qdyazSUOfMuPstVQE1ATLdUDeZFiCgRO4iYcjEviSSsXQuKT3agtad2qg8pza8w2rCmfuCjFZ87ntPKFfYqMkNTHkZB4EM/l+JEDwRXiOhRTfyVQU/xRzzq+PQ3rzSAGAPceoAmzIp6QgRVZDDAO67ktYVJ2Y9qfKGBggtQwXkZPsDy622zP8hODYLqUQlL3qsAgOL6a0RlqpOKFWJZEt4ZHfY3qBxHFUhlMyQfExZyZXMOrt4/SNNPNJwUkNbHLYXVVRuGGh2Wmc78vP464Tw==&quot;&#39;</span> <span class="se">\</span>
  -H <span class="s1">&#39;date: Fri, 15 May 2020 10:28:40 GMT&#39;</span>
</code></pre></div>
<p>Note that HTTP header <code>Authorization</code> starts with <code>Signature</code> and thus specifies that HTTP Signatures authentication type should be used. Signature metadata description is summarized in a following table:</p>
<table>
<thead>
<tr>
<th>Field  name</th>
<th>Sample value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>keyId</td>
<td>ad537135-59f5-4073-8f8e-1137fc19b9d2</td>
<td>Merchant certificate name that can be found in Certificates section in Klix Merchant Console</td>
</tr>
<tr>
<td>algorithm</td>
<td>rsa-sha256</td>
<td>Encryption algorithm used. Supported algorithms: rsa-sha256, rsa-sha384, rsa-sh512</td>
</tr>
<tr>
<td>headers</td>
<td>date (request-target)</td>
<td>HTTP headers that are included in signature. For HTTP requests without body at least <code>date</code> and <code>request-target</code> headers should be included. Field <code>(request-target)</code> is not a HTTP header but rather a combination of HTTP method and request URI e.g. in this case <code>get /v2/merchants/052eb290-a6ca-41f0-aac5-fd4ca14632e3/orders/a6f0f3c7-e3e7-4182-bc4c-bddec2a89d9a</code>. In case additional HTTP headers are included in signature these fields should also be added to headers list</td>
</tr>
</tbody>
</table>
<h4 id="signing-requests-with-request-body">Signing requests with request body<a class="headerlink" href="#signing-requests-with-request-body" title="Permanent link">&para;</a></h4>
<p>The following HTTP headers should be sent for all requests with a request body: Authorization, Date, Content-Type, Digest.
Signed HTTP POST request example:</p>
<div class="highlight"><pre><span></span><code>curl -X POST <span class="se">\</span>
  https://api.stage.klix.app/v2/merchants/052eb290-a6ca-41f0-aac5-fd4ca14632e3/orders/a6f0f3c7-e3e7-4182-bc4c-bddec2a89d9a/refunds <span class="se">\</span>
  -H <span class="s1">&#39;Authorization: Signature keyId=&quot;ad537135-59f5-4073-8f8e-1137fc19b9d2&quot;,algorithm=&quot;rsa-sha256&quot;,headers=&quot;digest date content-type (request-target)&quot;,signature=&quot;xkdqOeB0Iy4iaSQRgIWsyCuSewMzOcDISMdKO6ThFiRrvZXxdVnW1xY6WZH8E3y2qdyazSUOfMuPstVQE1ATLdUDeZFiCgRO4iYcjEviSSsXQuKT3agtad2qg8pza8w2rCmfuCjFZ87ntPKFfYqMkNTHkZB4EM/l+JEDwRXiOhRTfyVQU/xRzzq+PQ3rzSAGAPceoAmzIp6QgRVZDDAO67ktYVJ2Y9qfKGBggtQwXkZPsDy622zP8hODYLqUQlL3qsAgOL6a0RlqpOKFWJZEt4ZHfY3qBxHFUhlMyQfExZyZXMOrt4/SNNPNJwUkNbHLYXVVRuGGh2Wmc78vP464Tw==&quot;&#39;</span> <span class="se">\</span>
  -H <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="se">\</span>
  -H <span class="s1">&#39;content-length: 130&#39;</span> <span class="se">\</span>
  -H <span class="s1">&#39;date: Fri, 15 May 2020 10:28:40 GMT&#39;</span> <span class="se">\</span>
  -H <span class="s1">&#39;digest: sha-256=HoohlqpLJgeDLYagaolWSlbRC7/eMwK1O9TwgT27DzU=&#39;</span> <span class="se">\</span>
  -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;refundRequest&quot;: {</span>
<span class="s1">        &quot;amount&quot;: 5.00,</span>
<span class="s1">        &quot;reason&quot;: &quot;OTHER_REFUND&quot;,</span>
<span class="s1">        &quot;note&quot;: &quot;Internal note visible in Merchant Console&quot;</span>
<span class="s1">    }</span>
<span class="s1">}&#39;</span>
</code></pre></div>
<p>Signature metadata description that differs from HTTP requests without request body is summarized in a following table:</p>
<table>
<thead>
<tr>
<th>Field  name</th>
<th>Sample value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>headers</td>
<td>digest date content-type (request-target)</td>
<td>HTTP headers that are included in signature. For HTTP requests with body at least <code>digest</code>, <code>date</code>, <code>content-type</code> and <code>request-target</code> headers should be included. Field <code>(request-target)</code> is not a HTTP header but rather a combination of HTTP method and request URI e.g. in this case <code>post /v2/merchants/052eb290-a6ca-41f0-aac5-fd4ca14632e3/orders/a6f0f3c7-e3e7-4182-bc4c-bddec2a89d9a/refunds</code>. In case additional HTTP headers are included in signature these fields should also be added to headers list</td>
</tr>
</tbody>
</table>
<p>HTTP header <code>digest</code> consists of HTTP request body digest algorithm and digest value seperated by <code>=</code> sign i.e. <code>sha-256=base64(sha256(request body))</code>. Supported digest algorithms are SHA-256, SHA-384 and SHA-512. See <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Digest">additional details</a>.</p>
<h4 id="libraries">Libraries<a class="headerlink" href="#libraries" title="Permanent link">&para;</a></h4>
<p>Here is a list of libraries that can be used to simplify merchant authentication in Klix using HTTP Signatures specification. Note that this is not an extensive list and there might be a better candidate for programming language and framework used in your project.</p>
<table>
<thead>
<tr>
<th>Programming language</th>
<th>Library</th>
</tr>
</thead>
<tbody>
<tr>
<td>Go</td>
<td><a href="https://github.com/99designs/httpsignatures-go">99designs/httpsignatures-go</a></td>
</tr>
<tr>
<td>Java</td>
<td><a href="https://github.com/tomitribe/http-signatures-java">tomitribe/http-signatures-java</a></td>
</tr>
<tr>
<td>node.js</td>
<td><a href="https://github.com/joyent/node-http-signature">joyent/node-http-signature</a></td>
</tr>
<tr>
<td>PHP</td>
<td><a href="https://github.com/liamdennehy/http-signatures-php">liamdennehy/http-signatures-php</a></td>
</tr>
<tr>
<td>Ruby</td>
<td><a href="https://github.com/99designs/http-signatures-ruby">99designs/http-signatures-ruby</a></td>
</tr>
</tbody>
</table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../api/" title="Direct integration using API" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Direct integration using API
              </span>
            </div>
          </a>
        
        
          <a href="../static-assets/" title="Static assets" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Static assets
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2021 Klix
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/klix-app" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/klixapp" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://lv.linkedin.com/company/klixapp" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>